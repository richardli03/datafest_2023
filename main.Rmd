---
title: "Datafest"
author: "Drew, Richard, Anmol, Meredith, An"
date: 2023-4-7
output:
  github_document:
    toc: true
---

# Question

# Setup

<!-- ----------------------------------------------------------------------- -->

```{r setup}
library(tidyverse)
```

# Data Wrangling

```{r clean_data}
# Fix data import by combining the transcript and time columns, then separate the columns back to the separate 
questionposts <- read_csv("data/questionposts.csv")
questionposts
questionposts_fixed <- questionposts %>% 
  unite(PostText, "PostText", "CreatedUtc") %>%
  mutate(CreatedUtc = str_sub(PostText, -20),
         PostText = str_sub(PostText, end = -21)) %>%
  mutate(CreatedUtc = str_replace(CreatedUtc, pattern = "_|\"|,", replacement = ""))
questionposts_fixed
```

```{r join_data}
# Combine four relevent datasets for easier analysis

# Read in the csv file as a dataframe
questions <- read_csv("data/questions.csv")
clients <- read_csv("data/clients.csv")
attorneys <- read_csv("data/attorneys.csv")

# Join the two dataframes by the common column "QuestionUNO"
mega_df <- left_join(questionposts, questions, by = "QuestionUno") %>% 
  left_join(clients, by = c("AskedByClientUno" = "ClientUno")) %>% 
  left_join(attorneys, by = c("TakenByAttorneyUno" = "AttorneyUno")) %>% 
  select(c("StateAbbr.x", "QuestionUno", "PostText", "CreatedUtc.x", "Category",
           "Subcategory", "AskedByClientUno", "AskedOnUtc", 
           "TakenByAttorneyUno", "TakenOnUtc", "ClosedByAttorneyUno", 
           "ClosedOnUtc", "LegalDeadline", "County.x", "EthnicIdentity", "Age",
           "Gender", "MaritalStatus", "Veteran", "Imprisoned", 
           "NumberInHousehold", "AnnualIncome", "AllowedIncome", 
           "CheckingBalance", "SavingsBalance", "InvestmentsBalance")) %>% 
  rename("StateAbbr" = "StateAbbr.x", "County" = "County.x", 
         "CreatedUtc" = "CreatedUtc.x")

# Remove rows if a state abbreviation is longer than two characters
cleaned_df <- mega_df %>% 
  filter(nchar(StateAbbr) == 2)


```

```{r first_post_separation}
first_post_df <- cleaned_df %>%
  group_by(QuestionUno) %>%
  arrange(CreatedUtc) %>%
  distinct(QuestionUno, .keep_all = TRUE) %>%
  arrange(QuestionUno) %>%
  ungroup()
```
